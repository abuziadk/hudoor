<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>سجل الحضور</title>
<style>
body {font-family: "Tajawal", sans-serif; background:#f4f6f8; margin:0; padding:0; text-align:center;}
.container {max-width:600px; margin:30px auto; background:#fff; padding:20px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.1);}
h2 {color:#1a73e8;}
table {width:100%; margin-top:15px; border-collapse:collapse;}
th, td {padding:10px; border-bottom:1px solid #ddd;}
th {background:#1a73e8; color:#fff;}
button {background:#d9534f; color:white; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; font-size:16px; margin-top:15px;}
</style>
</head>
<body>
<div class="container">
<h2>سجل الحضور</h2>
<table id="attendanceTable">
<tr><th>الاسم</th><th>رقم الهوية</th><th>الصف</th><th>الفصل</th><th>التاريخ</th><th>الوقت</th></tr>
</table>

<button onclick="clearAttendance()">مسح السجل</button>
<a href="scan-camera.html" style="color:#1a73e8; display:block; margin-top:10px;">العودة لمسح QR</a>
<a href="absent.html" style="color:#1a73e8; display:block; margin-top:5px;">عرض الغائبين</a>

<button onclick="exportExcel()">تصدير إلى Excel</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
let attendance = JSON.parse(localStorage.getItem('attendance') || '[]');
let table = document.getElementById('attendanceTable');

attendance.reverse().forEach(record=>{
    table.innerHTML += `<tr>
        <td>${record.name}</td>
        <td>${record.civilId}</td>
        <td>${record.grade || ''}</td>
        <td>${record.section || ''}</td>
        <td>${record.date}</td>
        <td>${record.time}</td>
    </tr>`;
});

function clearAttendance(){
    if(confirm("هل أنت متأكد من مسح السجل؟")){
        localStorage.removeItem('attendance');
        location.reload();
    }
}

function exportExcel(){
    if(!attendance.length){ alert("لا يوجد بيانات للتصدير"); return; }
    const ws = XLSX.utils.json_to_sheet(attendance);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "الحضور");
    XLSX.writeFile(wb, "attendance.xlsx");
}
</script>
</body>
</html>
